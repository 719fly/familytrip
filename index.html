<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æé¾å®¶æ— 2026 å±±æ¢¨ä¹‹æ—… V24</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@700;900&family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/dist/css/all.min.css">
    <style>
        :root { 
            --bg: #f9f7f2; --ink: #1a1a1a; --gray-btn: #f0f0f0; 
            --sightseeing-bg: #f1f3f0; --sightseeing-border: #6b705c;
            --food-bg: #fff5f5; --food-border: #a52a2a;
            --transport-bg: #f0f4f8; --transport-border: #4a5568;
            --stay-bg: #fff9eb; --stay-border: #d4a373;
        }
        body { font-family: 'Noto Sans TC', sans-serif; background-color: var(--bg); color: var(--ink); -webkit-font-smoothing: antialiased; }
        .serif { font-family: 'Noto Serif TC', serif; }
        .date-nav::-webkit-scrollbar { display: none; }
        .date-item { flex: 0 0 65px; text-align: center; color: #ccc; transition: 0.3s; }
        .date-item.active { color: var(--ink); transform: scale(1.1); font-weight: 900; }
        .date-item.active .active-dot { background: var(--food-border); width: 4px; height: 4px; border-radius: 50%; margin: 4px auto 0; }
        
        .card-type { border-left: 6px solid transparent; border-radius: 2rem; overflow: hidden; margin-bottom: 1.5rem; background: #fff; position: relative; }
        .type-sightseeing { border-left-color: var(--sightseeing-border); background-color: var(--sightseeing-bg); }
        .type-food { border-left-color: var(--food-border); background-color: var(--food-bg); }
        .type-transport { border-left-color: var(--transport-border); background-color: var(--transport-bg); }
        .type-stay { border-left-color: var(--stay-border); background-color: var(--stay-bg); }
        
        .btn-gray { background-color: var(--gray-btn); color: var(--ink); border-radius: 12px; font-weight: 700; border: none; transition: 0.2s; height: 50px; width: 100%; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-gray:active { background: #e0e0e0; transform: scale(0.98); }
        
        .map-overlay { background: linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.5)), url('https://images.unsplash.com/photo-1493976040374-85c8e12f0c0e?auto=format&fit=crop&w=800&q=80'); background-size: cover; background-position: center; }
        .drive-info { display: flex; align-items: center; justify-content: center; gap: 8px; font-size: 11px; color: #999; margin: 15px 0; }
        .drive-info hr { flex-grow: 1; border: 0; border-top: 1px dashed #ccc; }

        #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 1000; backdrop-filter: blur(8px); }
        .modal-content { background: var(--bg); height: 90vh; margin-top: 10vh; border-radius: 32px 32px 0 0; padding: 24px; overflow-y: auto; }
        
        .img-wrapper { position: relative; width: 75px; height: 75px; flex-shrink: 0; margin-right: 8px; }
        .thumb-img { width: 100%; height: 100%; object-fit: cover; border-radius: 12px; border: 2px solid white; }
        .del-badge { position: absolute; top: -10px; right: -10px; background: #ff4d4f; color: white; border-radius: 50%; width: 26px; height: 26px; font-size: 18px; display: flex; align-items: center; justify-content: center; border: 2px solid white; cursor: pointer; z-index: 99; font-weight: bold; }
    </style>
</head>
<body class="pb-10">

    <header class="bg-white/95 sticky top-0 z-50 pt-12 pb-6 border-b border-gray-100 text-center">
        <div class="inline-block bg-gray-100 text-gray-500 px-3 py-1 rounded-full text-[10px] font-bold mb-2">2026.02</div>
        <h1 class="serif text-3xl mb-8 text-ink">æé¾å®¶æ—å±±æ¢¨ä¹‹æ—…</h1>
        <div id="date-nav" class="date-nav flex overflow-x-auto px-6 gap-4"></div>
    </header>

    <main class="px-6 mt-6">
        <div onclick="openDailyRoute()" class="w-full h-48 rounded-[2.5rem] map-overlay shadow-lg mb-8 flex flex-col items-center justify-center text-white cursor-pointer border-4 border-white">
            <i class="fa-solid fa-map-location-dot text-4xl mb-2"></i>
            <span class="font-bold text-sm bg-black/40 px-5 py-1.5 rounded-full text-center">æŸ¥çœ‹ä»Šæ—¥å°èˆªè·¯å¾‘</span>
        </div>
        <div id="events-list"></div>
    </main>

    <div id="modal" onclick="closeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="w-12 h-1 bg-gray-200 rounded-full mx-auto mb-8"></div>
            <div id="modal-body"></div>
        </div>
    </div>

    <script>
        const HOME_COORD = "35.824889,138.367139";
        const travelData = [
            { date: "2/17", weekday: "TUE", stay: "å§‘å§‘å®¶", stayAddr: HOME_COORD, firstDrive: "2h 47m", firstDist: "225km",
              events: [
                { type: "transport", title: "æ¡ƒåœ’ â” æˆç”° (TR898)", info: "06:40-10:40", map: "Narita Airport" },
                { type: "food", title: "å‘³äºæ‹‰éºµ", map: "35.8304,138.3662" }
              ], lastDrive: "2m", lastDist: "0.8km"
            },
            { date: "2/18", weekday: "WED", stay: "å§‘å§‘å®¶", stayAddr: HOME_COORD, firstDrive: "34m", firstDist: "31.7km",
              events: [
                { type: "sightseeing", title: "èˆé¶´åŸå…¬åœ’", map: "èˆé¶´åŸå…¬åœ’", drive: "10m", dist: "5km" },
                { type: "food", title: "äº”å‘³é¤…è“å­åº—", map: "äº”å‘³é¤…è“å­åº—", drive: "10m", dist: "3km" },
                { type: "food", title: "é›ãã° akari", map: "é¶ãã°Akari" }
              ], lastDrive: "15m", lastDist: "12km"
            },
            { date: "2/19", weekday: "THU", stay: "å§‘å§‘å®¶", stayAddr: HOME_COORD, firstDrive: "21m", firstDist: "16.2km",
              events: [
                { type: "sightseeing", title: "èŒæœ¨ä¹‹æ‘", map: "èŒæœ¨ä¹‹æ‘", drive: "5m", dist: "3km" },
                { type: "food", title: "ROCK é¤å»³", map: "Moeginomura ROCK", drive: "5m", dist: "1km" },
                { type: "food", title: "æ¸…é‡Œã‚¸ãƒ£ãƒ  å’–å•¡å»³", map: "æ¸…é‡Œã‚¸ãƒ£ãƒ ", drive: "25m", dist: "18km" },
                { type: "food", title: "ä¸¸æ”¿ãã° è•éº¥éºµ", map: "ä¸¸æ”¿ãã° é•·å‚åº—" }
              ], lastDrive: "8m", lastDist: "4km"
            },
            { date: "2/20", weekday: "FRI", stay: "å§‘å§‘å®¶", stayAddr: HOME_COORD, firstDrive: "1h 24m", firstDist: "95km",
              events: [
                { type: "food", title: "é‡‘ã¨ã (éœå²¡)", map: "é‡‘ã¨ã è‹¥æ¾ç”ºæœ¬åº—", drive: "25m", dist: "15km" },
                { type: "sightseeing", title: "arinko farm æ¡è‰è“", map: "Arinko Farm", drive: "35m", dist: "25km" },
                { type: "sightseeing", title: "ä¸‰ä¿æ¾åŸ", map: "ä¸‰ä¿æ¾åŸ", drive: "30m", dist: "20km" },
                { type: "sightseeing", title: "å³æœç”ºååº—è¡—", map: "éœå²¡å³æœç”º", drive: "5m", dist: "2km" },
                { type: "food", title: "nanaya å†°æ·‡æ·‹", map: "ãªãªã‚„ éœå²¡åº—", drive: "15m", dist: "10km" },
                { type: "food", title: "tsukanto ç‚¸è±¬æ’", map: "tsukanto éœå²¡" }
              ], lastDrive: "1h 45m", lastDist: "110km"
            },
            { date: "2/21", weekday: "SAT", stay: "æ—…é¤¨ã‚ã‚‰ã³é‡", stayAddr: "36.6713,138.4069", firstDrive: "55m", firstDist: "73.5km",
              events: [
                { type: "food", title: "ç°—ä¹‹é°»è§€å…‰èŠ æ¾æœ¬åº—", map: "ç°—ä¹‹é°»è§€å…‰èŠ", drive: "30m", dist: "22km" },
                { type: "sightseeing", title: "å¤§ç‹å±±è‘µè¾²å ´", map: "å¤§ç‹ã‚ã•ã³è¾²å ´", drive: "20m", dist: "15km" },
                { type: "food", title: "åŒ—ã‚¢ãƒ«ãƒ—ã‚¹ç‰§å ´ç›´å£²åº—", map: "åŒ—ã‚¢ãƒ«ãƒ—ã‚¹ç‰§å ´" }
              ], lastDrive: "1h 10m", lastDist: "65km"
            },
            { date: "2/22", weekday: "SUN", stay: "å§‘å§‘å®¶", stayAddr: HOME_COORD, firstDrive: "1h 38m", firstDist: "130km",
              events: [
                { type: "sightseeing", title: "åœ°ç„è°·é‡çŒ´æº«æ³‰", map: "åœ°ç„è°·é‡çŒ¿å…¬è‹‘", drive: "1h 50m", dist: "135km" },
                { type: "sightseeing", title: "è«è¨ªæ¹–", map: "è«è¨ªæ¹–", drive: "55m", dist: "50km" },
                { type: "sightseeing", title: "å¥½å¸‚å¤š å—é˜¿çˆ¾å‘æ–¯åº—", map: "Costco Minami Alpus" }
              ], lastDrive: "40m", lastDist: "30km"
            },
            { date: "2/23", weekday: "MON", stay: "å§‘å§‘å®¶", stayAddr: HOME_COORD, firstDrive: "30m", firstDist: "22km",
              events: [
                { type: "food", title: "è˜‡å·æ‹‰éºµ", map: "ãƒ©ãƒ¼ãƒ¡ãƒ³è˜‡æ´² é ˆç‰ç”º", drive: "20m", dist: "14km" },
                { type: "sightseeing", title: "Taiho Futaba", map: "Taiho Futaba", drive: "15m", dist: "10km" },
                { type: "sightseeing", title: "ç¬›å¹å·æ°´æœå…¬åœ’", map: "ç¬›å¹å·ãƒ•ãƒ«ãƒ¼ãƒ„å…¬åœ’", drive: "5m", dist: "2km" },
                { type: "sightseeing", title: "Fruit Spa PukuPuku æ³¡æ¹¯", map: "ã·ãã·ãæº«æ³‰" }
              ], lastDrive: "50m", lastDist: "45km"
            },
            { date: "2/24", weekday: "TUE", stay: "å§‘å§‘å®¶", stayAddr: HOME_COORD, firstDrive: "1h 31m", firstDist: "117km",
              events: [
                { type: "food", title: "Junchan Sushi", map: "ã˜ã‚…ã‚“ã¡ã‚ƒã‚“å¯¿å¸", drive: "15m", dist: "10km" },
                { type: "food", title: "TOKYO FARM VILLAGE", map: "TOKYO FARM VILLAGE", drive: "10m", dist: "6km" },
                { type: "food", title: "ãƒ‘ãƒšãƒ«ãƒ–ãƒ«ã‚° (å’–å•¡å»³)", map: "PAPPELBURG", drive: "20m", dist: "15km" },
                { type: "food", title: "ã²ãªé³¥å±± (é ç´„ 16:00)", map: "ã²ãªé³¥å±±" }
              ], lastDrive: "1h 10m", lastDist: "75km"
            },
            { date: "2/25", weekday: "WED", stay: "å›ç¨‹", stayAddr: "æˆç”°æ©Ÿå ´",
              events: [ { type: "transport", title: "æ³°åœ‹ç…å­èˆªç©º SL395", info: "17:15-20:20", map: "Narita Airport" } ]
            }
        ];

        let currentIdx = 0;

        function init() { renderNav(); switchDay(0); }

        function renderNav() {
            const nav = document.getElementById('date-nav');
            nav.innerHTML = '';
            travelData.forEach((day, i) => {
                const div = document.createElement('div');
                div.className = `date-item cursor-pointer`;
                div.id = `nav-${i}`;
                div.onclick = () => switchDay(i);
                div.innerHTML = `<div class="text-[10px] font-bold uppercase">${day.weekday}</div><div class="text-xl serif mt-1">${day.date.split('/')[1]}</div><div class="active-dot"></div>`;
                nav.appendChild(div);
            });
        }

        function switchDay(i) {
            currentIdx = i;
            document.querySelectorAll('.date-item').forEach(el => el.classList.remove('active'));
            const activeNav = document.getElementById(`nav-${i}`);
            if(activeNav) activeNav.classList.add('active');

            const list = document.getElementById('events-list');
            list.innerHTML = '';
            const day = travelData[i];

            if(day.firstDrive) {
                const originText = (i === 0) ? "æˆç”°æ©Ÿå ´" : "å‰æ—¥ä¸‹æ¦»è™•";
                list.innerHTML += `<div class="drive-info"><hr><i class="fa-solid fa-car"></i> ğŸš— ${originText} â” ç¬¬ä¸€ç«™ç´„ ${day.firstDrive} (${day.firstDist})<hr></div>`;
            }

            day.events.forEach((ev, evIdx) => {
                renderCard(list, ev, i, evIdx);
                if(ev.drive) list.innerHTML += `<div class="drive-info"><hr><i class="fa-solid fa-car"></i> ğŸš— é§•è»Šç´„ ${ev.drive} (${ev.dist})<hr></div>`;
            });

            if(i !== 8) {
                list.innerHTML += `<div class="drive-info"><hr><i class="fa-solid fa-house"></i> ğŸ  è¿”å›ä¸‹æ¦»è™•ç´„ ${day.lastDrive} (${day.lastDist})<hr></div>`;
                renderCard(list, { type: "stay", title: `ä»Šæ—¥ä¸‹æ¦»ï¼š${day.stay}`, map: day.stayAddr }, i, 99);
            }
            window.scrollTo(0,0);
        }

        function renderCard(container, ev, dIdx, eIdx) {
            const photoKey = `photo_${dIdx}_${eIdx}`;
            const imgs = JSON.parse(localStorage.getItem(photoKey) || '[]');
            const div = document.createElement('div');
            div.className = `card-type p-6 type-${ev.type || 'sightseeing'}`;

            let imgsHtml = '';
            if(imgs.length > 0) {
                imgsHtml = `<div class="flex mt-4 overflow-x-auto pb-2">`;
                imgs.forEach((src, idx) => {
                    imgsHtml += `<div class="img-wrapper">
                                    <img src="${src}" class="thumb-img">
                                    <div class="del-badge" onclick="event.stopPropagation(); deleteImg(${dIdx}, ${eIdx}, ${idx})">Ã—</div>
                                 </div>`;
                });
                imgsHtml += `</div>`;
            }

            div.innerHTML = `
                <div onclick="openModal(${eIdx})">
                    <div class="flex justify-between items-start mb-2">
                        <p class="text-[9px] font-black uppercase opacity-30 tracking-widest">${ev.type || 'sightseeing'}</p>
                        <i class="fa-solid fa-chevron-right text-[10px] text-gray-200"></i>
                    </div>
                    <h4 class="serif text-xl font-bold">${ev.title}</h4>
                    ${ev.info ? `<p class="text-xs text-red-600 font-bold mt-1">${ev.info}</p>` : ''}
                    ${imgsHtml}
                </div>
                <div class="flex gap-2 mt-6">
                    <button onclick="window.open('https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(ev.map)}')" class="btn-gray flex-1 text-[13px]"><i class="fa-solid fa-location-arrow"></i> å°èˆª</button>
                    <label class="btn-gray flex-1 text-[13px] cursor-pointer"><i class="fa-solid fa-camera"></i> ä¸Šå‚³ç…§ç‰‡<input type="file" accept="image/*" class="hidden" onchange="uploadPhoto(this, ${eIdx})"></label>
                </div>
            `;
            container.appendChild(div);
        }

        function deleteImg(dIdx, eIdx, iIdx) {
            if(!confirm("ç¢ºå®šè¦åˆªé™¤é€™å¼µç…§ç‰‡å—ï¼Ÿ")) return;
            const key = `photo_${dIdx}_${eIdx}`;
            let imgs = JSON.parse(localStorage.getItem(key) || '[]');
            imgs.splice(iIdx, 1);
            localStorage.setItem(key, JSON.stringify(imgs));
            // å¼·åˆ¶å»¶é²å¾Œåˆ·æ–°ä»‹é¢ï¼Œé˜²æ­¢ç€è¦½å™¨ç·©å­˜ UI
            setTimeout(() => { switchDay(currentIdx); }, 50);
        }

        function openModal(eIdx) {
            const day = travelData[currentIdx];
            const ev = eIdx === 99 ? { title: `ä»Šæ—¥ä¸‹æ¦»ï¼š${day.stay}` } : day.events[eIdx];
            const key = `photo_${currentIdx}_${eIdx}`;
            const imgs = JSON.parse(localStorage.getItem(key) || '[]');
            const note = localStorage.getItem(`note_${currentIdx}_${eIdx}`) || '';
            
            document.getElementById('modal-body').innerHTML = `
                <h2 class="serif text-3xl font-black mb-6 text-ink">${ev.title}</h2>
                <div class="bg-white p-6 rounded-3xl mb-8 border border-gray-100 shadow-inner">
                    <textarea id="note-input" oninput="saveNote(${eIdx})" placeholder="å¯«ä¸‹å€¼å¾—ç´€éŒ„çš„æ™‚åˆ»..." class="w-full h-40 bg-transparent outline-none text-sm resize-none leading-relaxed text-gray-700">${note}</textarea>
                </div>
                <div class="grid grid-cols-1 gap-6">
                    ${imgs.map((src, idx) => `
                        <div class="relative">
                            <img src="${src}" class="w-full h-auto rounded-3xl shadow-lg border-4 border-white">
                            <button onclick="deleteImg(${currentIdx}, ${eIdx}, ${idx}); closeModal();" class="w-full mt-3 py-4 text-sm text-red-500 font-bold bg-white border border-red-100 rounded-2xl active:bg-red-50">ğŸ—‘ï¸ åˆªé™¤æ­¤å›æ†¶ç…§ç‰‡</button>
                        </div>`).join('')}
                </div>
            `;
            document.getElementById('modal').style.display = 'block';
        }

        function saveNote(eIdx) { localStorage.setItem(`note_${currentIdx}_${eIdx}`, document.getElementById('note-input').value); }
        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        async function uploadPhoto(input, eIdx) {
            const file = input.files[0]; if(!file) return;
            const reader = new FileReader(); reader.readAsDataURL(file);
            reader.onload = (e) => {
                const img = new Image(); img.src = e.target.result;
                img.onload = () => {
                    const canvas = document.createElement('canvas'); const MAX_W = 800;
                    canvas.width = MAX_W; canvas.height = img.height * (MAX_W / img.width);
                    const ctx = canvas.getContext('2d'); ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    const key = `photo_${currentIdx}_${eIdx}`;
                    let imgs = JSON.parse(localStorage.getItem(key) || '[]');
                    imgs.push(canvas.toDataURL('image/jpeg', 0.7));
                    localStorage.setItem(key, JSON.stringify(imgs));
                    switchDay(currentIdx);
                };
            };
        }

        function openDailyRoute() {
            const day = travelData[currentIdx];
            const origin = (currentIdx === 0) ? "Narita Airport" : (currentIdx === 4) ? "36.6713,138.4069" : HOME_COORD;
            const waypoints = day.events.map(e => encodeURIComponent(e.map)).join('/');
            const url = `https://www.google.com/maps/dir/${encodeURIComponent(origin)}/${waypoints}/${encodeURIComponent(day.stayAddr)}`;
            window.open(url, '_blank');
        }

        init();
    </script>
</body>
</html>